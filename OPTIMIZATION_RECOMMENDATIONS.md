# –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞ main.cpp

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –∫–∞—Ç—É—à–∫–∏
**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–∞—Ç—É—à–∫–∞ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞, –∞ –¥–æ–ª–∂–Ω–∞ –≤–∫–ª—é—á–∞—Ç—å—Å—è –¥–æ —Ç–∞–π–º–µ—Ä–∞ (–≤ –ø–æ–∫–æ–µ) –∏ –≤—ã–∫–ª—é—á–∞—Ç—å—Å—è –Ω–∞ –≤—Ä–µ–º—è –æ—Ç–∫—Ä—ã—Ç–∏—è.

**–¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞**:
- –í–æ –≤—Ä–µ–º—è —Å—á–µ—Ç–∞: `coil_fl = 0` ‚Üí –∫–∞—Ç—É—à–∫–∞ –í–´–ö–õ–Æ–ß–ï–ù–ê (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
- –ü–æ—Å–ª–µ —Ç–∞–π–º–µ—Ä–∞: `coil_fl = 1` ‚Üí –∫–∞—Ç—É—à–∫–∞ –í–ö–õ–Æ–ß–ï–ù–ê

**–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞**:
- –í –ø–æ–∫–æ–µ –†2: –∫–∞—Ç—É—à–∫–∞ –í–ö–õ–Æ–ß–ï–ù–ê (–∑–∞–º–æ–∫ –∑–∞–∫—Ä—ã—Ç)
- –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏: –∫–∞—Ç—É—à–∫–∞ –í–´–ö–õ–Æ–ß–ê–ï–¢–°–Ø (–æ—Ç–∫—Ä—ã—Ç–∏–µ), —Ç–∞–π–º–µ—Ä 4 —Å–µ–∫
- –ü–æ—Å–ª–µ —Ç–∞–π–º–µ—Ä–∞: –∫–∞—Ç—É—à–∫–∞ –í–ö–õ–Æ–ß–ê–ï–¢–°–Ø –æ–±—Ä–∞—Ç–Ω–æ (–∑–∞–∫—Ä—ã—Ç–∏–µ)

**–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `coil()`:
- –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –≤ –†2: –∫–∞—Ç—É—à–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞
- –ü—Ä–∏ `press100ms && !press3s`: –∫–∞—Ç—É—à–∫–∞ –≤—ã–∫–ª—é—á–∞–µ—Ç—Å—è, —Ç–∞–π–º–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- –í–æ –≤—Ä–µ–º—è —Ç–∞–π–º–µ—Ä–∞: –∫–∞—Ç—É—à–∫–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–π
- –ü–æ—Å–ª–µ —Ç–∞–π–º–µ—Ä–∞: –∫–∞—Ç—É—à–∫–∞ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ

### 2. ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –≤ —Ä–µ–∂–∏–º–µ –†2 (–ø–æ–∫–æ–π)
**–ü—Ä–æ–±–ª–µ–º–∞**: –í –†2 –ø—Ä–∏ –ø–æ–∫–æ–µ (–∫–∞—Ç—É—à–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞) LED –¥–æ–ª–∂–µ–Ω –≥–æ—Ä–µ—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ, –Ω–æ —Ç–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç LED –ø—Ä–∏ `!press3s`.

**–†–µ—à–µ–Ω–∏–µ**: –ò–∑–º–µ–Ω–∏—Ç—å —É—Å–ª–æ–≤–∏–µ –≤ `ledpin()`:
- –†2 –ø–æ–∫–æ–π: `!press3s && coil_fl == 1` ‚Üí LED –≥–æ—Ä–∏—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
- –†2 –æ—Ç–∫—Ä—ã—Ç–∏–µ: `!press3s && coil_fl == 0` ‚Üí LED –±—ã—Å—Ç—Ä–æ –º–∏–≥–∞–µ—Ç
- –†1: `press3s == 1` ‚Üí LED –º–µ–¥–ª–µ–Ω–Ω–æ –º–∏–≥–∞–µ—Ç

### 3. ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ 4-—Å–µ–∫—É–Ω–¥–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –†1‚Üî–†2.

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å:
- –§–ª–∞–≥ `modeSwitchSignal` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–∏–≥–Ω–∞–ª–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
- –¢–∞–π–º–µ—Ä –Ω–∞ 4 —Å–µ–∫—É–Ω–¥—ã (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å timer1 –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å—á–µ—Ç—á–∏–∫)
- –í `ledpin()`: –ø—Ä–∏ `modeSwitchSignal` ‚Üí –±—ã—Å—Ç—Ä–æ–µ –º–∏–≥–∞–Ω–∏–µ (–∫–∞–∫ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏)

### 4. ‚ùå –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç—É—à–∫–∏
**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–∞—Ç—É—à–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã–∫–ª—é—á–µ–Ω–∞ (–†1), –Ω–æ —ç—Ç–æ –Ω–µ —è–≤–Ω–æ —É–∫–∞–∑–∞–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ**: –í `setup()` —è–≤–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞—Ç—É—à–∫—É –≤ –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
```cpp
PORTB &= ~_BV(coilPin); // coil off at startup (P1 mode)
```

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 5. ‚ö†Ô∏è –õ–∏—à–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è–º–∏
**–ü—Ä–æ–±–ª–µ–º–∞**: –í `ledpin()` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è `cli()/sei()` –¥–ª—è —á—Ç–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞, –Ω–æ `timer4_cntr` –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞ (–Ω–µ—Ç —É—Å–ª–æ–≤–∏—è), –ø–æ—ç—Ç–æ–º—É –º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å.

**–†–µ—à–µ–Ω–∏–µ**: –£–ø—Ä–æ—Å—Ç–∏—Ç—å —á—Ç–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Ç–æ–º–∞—Ä–Ω–æ–µ —á—Ç–µ–Ω–∏–µ.

### 6. ‚ö†Ô∏è –£–ø—Ä–æ—â–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞**: –í `coil()` –º–Ω–æ–∂–µ—Å—Ç–≤–æ —É—Å–ª–æ–≤–∏–π –º–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏.

### 7. ‚ö†Ô∏è –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥
**–ü—Ä–æ–±–ª–µ–º–∞**: –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.

**–†–µ—à–µ–Ω–∏–µ**: –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- `timer3_fl`, `timer3_cntr`, `timer3_counter` - –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
- –§—É–Ω–∫—Ü–∏—è `buzzer()` - –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞
- `BUZZ_DURATION` - –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞

### 8. ‚ö†Ô∏è –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
**–ü—Ä–æ–±–ª–µ–º–∞**: `timer2_fl` –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —è–≤–Ω–æ (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª—É—á–∞–π–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ).

**–†–µ—à–µ–Ω–∏–µ**: –í `setup()` –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
```cpp
timer2_fl = 1;
buttCntr = 0;
led_slow_cntr = 0;
coil_fl = 0; // –†1: coil off
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∫–æ–¥–∞

### 9. üìù –£–ª—É—á—à–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å —Ä—É—Å—Å–∫–∏–µ (–µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ)
- –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Å–ª–æ–∂–Ω—ã–º –ª–æ–≥–∏—á–µ—Å–∫–∏–º –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º

### 10. üìù –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
- –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏–π: `#define MODE_P1_OPEN 1`, `#define MODE_P2_LOCKED 0`

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **–í—ã—Å–æ–∫–∏–π**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∫–∞—Ç—É—à–∫–∏ (#1)
2. **–í—ã—Å–æ–∫–∏–π**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ü–∏–∏ –†2 (#2)
3. **–í—ã—Å–æ–∫–∏–π**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤ (#3)
4. **–°—Ä–µ–¥–Ω–∏–π**: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (#4, #8)
5. **–ù–∏–∑–∫–∏–π**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (#5, #6, #7)
6. **–ù–∏–∑–∫–∏–π**: –£–ª—É—á—à–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (#9, #10)

---

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è –ø—Ä–∏–º–µ–Ω–∏–ª —ç—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ–¥–µ?
